<!--[if (gte IE 9)|!(IE)]><!-->
<html lang="en"> <!--<![endif]-->
<head>

    <!-- Basic Page Needs
    ================================================== -->
    <meta charset="utf-8">
    <title>SellBnB</title>

    <!-- Mobile Specific Metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/colors/blue.css" id="colors">

    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

</head>

<body class="boxed">
<div id="wrapper">

    <% include header.ejs %>


    <!-- Titlebar
    ================================================== -->
    <section class="parallax-titlebar fullwidth-element"  data-background="#000" data-opacity="0.2" data-height="160">

        <img src="images/mini-slides/10.jpg" alt="" />
        <div class="parallax-overlay"></div>

        <div class="parallax-content">
            <h2>Make Offer <span>Submit Your Offer</span></h2>

            <nav id="breadcrumbs">
                <ul>
                    <li>Home</li>
                    <li>News</li>
                </ul>
            </nav>
        </div>
    </section>
    <% if(message != null && message != undefined && message != "") {%>
        <div class="notification success closeable" id="message_success" style="margin-top: -38px;">
            <p><span><%= message %></span></p>
            <a class="close" href="#"></a>
        </div>
    <% } %>
    <div class="notification error closeable" id="error_message" style="margin-top: -38px; display: none">
        <p><span id="message_span"></span></p>
        <a class="close" href="#"></a>
    </div>

    <div class="container container">

        <!-- Slider
        ================================================== -->
        <div class="eight columns">
            <!-- Headline -->
            <section class="title">
                <h2><%= item.item.title %></h2>
                <%
                    var name='';
                    if(item.user.company_name != null && item.user.company_name != ''){
                        name = item.user.company_name;
                    } else if(item.user.full_name != null && item.user.full_name != ''){
                        name = item.user.full_name;
                    }else if(item.user.username != null && item.user.username != ''){
                        name = item.user.username;
                    }
                %>
                <h6><%= item.commodity.name %></h6>
                <h6><a href="/user/public/userId/<%= item.user.id %>"><%= name %></a></h6>

                <%
                    var rateInString = ['zero', 'one', 'two', 'three', 'four', 'five'];

                    var rate_quality = item.user.rate_quality;
                    var rate_delivery = item.user.rate_delivery;
                    var rate_reliablity_seller = item.user.rate_reliablity_seller;
                    var payment = item.user.payment;
                    var efficiency = item.user.efficiency;
                    var rate_reliablity_buyer = item.user.rate_reliablity_buyer;

                    var feedbackCount = item.user.no_of_ratings_delivery+item.user.no_of_ratings_quality+item.user.no_of_ratings_efficiency
                            +item.user.no_of_ratings_payment+item.user.no_of_ratings_reliablity_buyer
                            +item.user.no_of_ratings_reliablity_seller;
                    var avgRate = (rate_quality+rate_delivery+rate_reliablity_buyer+rate_reliablity_seller+payment+efficiency)/6.0;
                    avgRate = Math.round( avgRate * 10) / 10;
                %>

                <% if(feedbackCount != 0) {%>
                <div class="reviews-counter-product">
                    <div class="rating <%if(avgRate >= 1) {%><%= rateInString[Math.floor(avgRate)] %>-stars<%}%>">
                        <%if(avgRate >= 1) {%><div class="star-rating"></div><%}%>
                        <div class="star-bg"></div>
                    </div>
                    <span style="float: left">(<%= avgRate %>)</span>
                </div>
                <% } %>
            </section>
            <div class="slider-padding">
                <div id="product-slider" class="royalSlider rsDefault">
                    <% if(item.itemImages.length > 0) {%>
                        <% for(imageIndex = 0; imageIndex < item.itemImages.length; imageIndex++) {;%>
                            <img style="width: 350px; height: 350px"
                                 class="rsImg" src="uploads/items/<%= item.itemImages[imageIndex].url %>"
                                 data-rsTmb="uploads/items/<%= item.itemImages[imageIndex].url %>"
                                 alt=""/>
                        <% } %>
                    <% } else {  %>
                        <img class="rsImg" src="images/product_item_01a.jpg" data-rsTmb="images/product_item_thumb_01a.png"
                             alt=""/>
                    <% } %>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="product-page">

                    <!-- Product Details Table -->
                    <div class="product-div">
                        <table class="basic-table">
                            <tr>
                                <th>Quantity</th>
                                <td><%= item.item.quantity %></td>
                            </tr>

                            <tr>
                                <th>Packing Type</th>
                                <td><%= item.item.packageType %></td>
                            </tr>

                            <tr>
                                <th>Delivery By</th>
                                <td id="item_delivery_by"><%= item.item.deliveryBy %></td>
                            </tr>

                            <tr>
                                <th>Warehouse Address</th>
                                <%
                                var warehouse = item.warehouse;
                                var formattedAddress = "";
                                formattedAddress = (warehouse.warehouseAddress1 != null && warehouse.warehouseAddress1 != undefined) ?
                                        warehouse.warehouseAddress1 : formattedAddress;
                                formattedAddress = (warehouse.warehouseAddress2 != null && warehouse.warehouseAddress2 != undefined) ?
                                formattedAddress + ", " +warehouse.warehouseAddress2 : formattedAddress;
                                formattedAddress = (warehouse.warehouseCity != null && warehouse.warehouseCity != undefined) ?
                                formattedAddress + ", " +warehouse.warehouseCity : formattedAddress;
                                %>
                                <td><%= formattedAddress %></td>
                            </tr>

                            <tr>
                                <th>Payment terms</th>
                                <td><%= item.item.paymentTerms %></td>
                            </tr>

                            <tr>
                                <th>Suggested Price</th>
                                <td id="suggested_price"><%= item.item.suggestedPrice %></td>
                            </tr>
                        </table>
                    </div>

                    <div class="product-seller-note">
                        <p class="margin-reset"><strong>Seller Note : </strong><%= item.item.note%></p>
                    </div>

            </div>
        </div>


        <!-- Content
        ================================================== -->
        <div class="seven columns">

        </div>

        <div class="eight products columns">
            <section class="variables">
                <form method="POST" action="/api/bid/add" id="bidformToSubmit">

                        <input type="hidden" name="id" value="<%= item.item.id %>"/>
                        <input type="hidden" name="userId" value="<%= user.id %>"/>
                        <div class="eight alpha columns bidform">
                            <label>Your Offer : </label>
                            <div class="four columns" style="margin-left: 0px;">
                                <input name="bid" type="text" id="your_bid"/>
                            </div>
                            <div class="two columns" style="width:120px">
                                <select name="priceUnit" id="priceUnit">
                                    <% for(var priceIndex = 0; priceIndex < item.priceUnits.length; priceIndex++) { %>
                                    <option value="<%= item.priceUnits[priceIndex].unitName %>"><%= item.priceUnits[priceIndex].unitName %></option>
                                    <% } %>
                                </select>
                            </div>
                            <div class="two columns bidform" style="margin-top: -10px">
                                <input type="submit" class="submit" id="submit" value="Make Offer" style="margin-left: 0px"/>
                            </div>
                        </div>


                        <div class="eight alpha columns bidform">
                            <label for="delivery_by">Delivery By : </label>
                            <select id="delivery_by" name="delivery_by">
                                <option value="Buyer">Buyer</option>
                                <% if(item.item.deliveryBy == 'Seller') {%>
                                <option selected value="Seller">Seller</option>
                                <% } else {%>
                                <option value="Seller">Seller</option>
                                <% } %>
                            </select>
                        </div>

                        <div class="eight alpha columns bidform" id="buyer_delivery_cost" style="display: none;">
                            <label>Delivery Cost : </label>

                            <div class="six columns" style="margin-left: 0px;">
                                <input name="delivery_cost" type="text" id="delivery_cost"/>
                            </div>
                            <div class="two columns" style="width:120px">
                                <select name="priceUnitDelivery" id="priceUnitDelivery">
                                    <% for(var priceIndex = 0; priceIndex < item.priceUnits.length; priceIndex++) { %>
                                    <option value="<%= item.priceUnits[priceIndex].unitName %>"><%= item.priceUnits[priceIndex].unitName %></option>
                                    <% } %>
                                </select>
                            </div>
                        </div>

                        <div class="eight alpha columns bidform" id="buyer_warehouse">
                            <label for="warehouse">Warehouse : </label>
                            <select id="warehouse" name="warehouse">
                                <% for(var warehouseIndex = 0; warehouseIndex < userWareHouses.length; warehouseIndex++) {
                                    var warehouse = userWareHouses[warehouseIndex];
                                    var formattedAddress = "";
                                    formattedAddress = (warehouse.warehouseAddress1 != null && warehouse.warehouseAddress1 != undefined) ?
                                            warehouse.warehouseAddress1 : formattedAddress;
                                    formattedAddress = (warehouse.warehouseAddress2 != null && warehouse.warehouseAddress2 != undefined) ?
                                    formattedAddress + ", " +warehouse.warehouseAddress2 : formattedAddress;
                                    formattedAddress = (warehouse.warehouseCity != null && warehouse.warehouseCity != undefined) ?
                                    formattedAddress + ", " +warehouse.warehouseCity : formattedAddress;
                                %>
                                <option value="<%= warehouse.id %>"><%= formattedAddress %></option>
                                <% } %>
                            </select>
                        </div>
                    <input type="submit" class="submit" id="submitFormBtn" value="Place Bid" style="display:none"/>
                    <div class="clearfix"></div>
                </form>
                <br>
                <div class="notification notice" align="center">
                    <%
                    var numdays = Math.floor(item.remainingTime / 86400);
                    var numhours = Math.floor((item.remainingTime % 86400) / 3600);
                    var numminutes = Math.floor(((item.remainingTime % 86400) % 3600) / 60);
                    var numseconds = Math.floor(((item.remainingTime % 86400) % 3600) % 60);
                    var isAlligibleToBid = true;


                    var formattedTime = "";
                    formattedTime = numdays != 0 ? (formattedTime += numdays + " days ") : formattedTime;
                    formattedTime = numhours != 0 ? (formattedTime += numhours + " hrs ") : formattedTime;
                    formattedTime = numminutes != 0 ? (formattedTime += numminutes + " mins ") : formattedTime;
                    formattedTime = numseconds != 0 ? (formattedTime += numseconds + " secs ") : formattedTime;

                    if(numdays <= 0 && numhours <= 0 && numminutes <= 0 && numseconds <= 0) {
                        isAlligibleToBid = false;
                    }
                    %>
                    <% if(isAlligibleToBid) {%>
                    <h4><span>Time left : </span> <%= formattedTime %></h4>
                    <% } else { %>
                    <h4><span>Time left : </span> 0 days 0 hrs 0 mins 0 secs</h4>
                    <% } %>

                </div>

                <!-- Bid Table -->
                <div class="last-bid" align="center">
                    <table border="0px">
                        <tr>
                            <td class="last-bid-label">
                                <strong>Your Last Offer </strong>
                            </td>
                            <td>
                                <%= lastUserBid != undefined ? lastUserBid.bid : 'No Offers' %>
                            </td>
                        </tr>
                        <tr>
                            <td class="last-bid-label">
                                <strong>Status </strong>
                            </td>
                            <td>
                                <% if(isAlligibleToBid){ %>
                                Open to bidding
                                <% } else { %>
                                Bidding Closed
                                <% } %>
                            </td>
                        </tr>
                    </table>
                </div>
                <br><br>
                <!-- Headline -->
                <div class="eight columns">
                    <h3 class="headline">Contact Seller</h3>
                    <span class="line margin-bottom-0"></span>
                </div>
                <br>
                <div class="last-bid" align="center">
                    <table border="0px">
                        <tr>
                            <td class="contact-label">
                                <span><img src="icons/small-message-icon.png" style="width: 24px; height: 24px; margin-top: 8px; margin-left: 8px"/></span>
                            </td>
                            <td>
                                <a href="#message-dialog" class="popup-with-zoom-anim margin-left-0" style="color: darkgray">Send Message</a>
                                <div id="message-dialog" class="small-dialog zoom-anim-dialog mfp-hide" style="margin-top: -850px">
                                    <h3 class="headline">Send Message</h3><span class="line margin-bottom-25"></span>
                                    <div class="clearfix"></div>

                                    <!-- Form -->
                                    <form id="add-comment" class="add-comment" action="/api/messages/add" method="POST">
                                        <fieldset>
                                            <input type="hidden" name="returnTo" value="/items/id/<%= item.item.id %>" />
                                            <input type="hidden" name="receiverUserIdFk" value="<%= item.user.id %>"/>
                                            <input type="hidden" name="senderUserIdFk" value="<%= user.id %>"/>
                                            <div class="twelve alpha columns editform">
                                                <label>Subject:</label>
                                                <input type="text" name="subject" placeholder="Type message subject"/>
                                            </div>
                                            <div>
                                                <label>Message:</label>
                                                <textarea cols="20" rows="3" name="message" style="width: 97%"></textarea>
                                            </div>
                                        </fieldset>

                                        <input type="submit" class="button color" value="Send Message" style="width: 100%"/>
                                        <div class="clearfix"></div>

                                    </form>
                                </div>
                            </td>
                        </tr>
                        <%if(item.phoneNumbers[0] != null && item.phoneNumbers[0] != undefined) {%>
                        <tr>
                            <td class="contact-label">
                                <span><img src="icons/mobile.png" style="width: 24px; height: 24px; margin-top: 8px; margin-left: 8px"/></span>
                            </td>
                            <td>
                                <a href="#" style="color: darkgray"><%= item.phoneNumbers[0].number %></a>
                            </td>
                        </tr>
                        <% } %>

                    </table>
                </div>
            </section>
        </div>

    </div>

    <br><br>
    <div class="container margin-top-5">

        <!-- Headline -->
        <div class="sixteen columns">
            <h3 class="headline">Reviews</h3>
            <span class="line margin-bottom-0"></span>
        </div>
        <br><br>
        <!-- Products -->
        <div class="products">

            <% if(userFeedback.length == 0) {%>
            <p>No Reviews Yet! </p>
            <%} %>
            <ul>
                <% for(commentIndex = 0; commentIndex < userFeedback.length; commentIndex++) {
                    var comment = userFeedback[commentIndex];
                    var rateInString = ['zero', 'one', 'two', 'three', 'four', 'five'];
                %>
                <li style="border-bottom: thin solid lightgray">
                    <div class="avatar">
                        <%if(comment.feedbackUserId.profile_pic == null) { %>
                        <img style="margin-top:5px; margin-left: 100px" src="http://www.gravatar.com/avatar/00000000000000000000000000000000?d=mm&amp;s=70" alt=""/>
                        <% } else { %>
                        <img src="/uploads/profile_pic/<%= comment.feedbackUserId.profile_pic %>" alt="" style="width: 80px; height: 80px;margin-top:5px; margin-left: 100px"/>
                        <% } %>
                    </div>
                    <%
                        var rateInString = ['zero', 'one', 'two', 'three', 'four', 'five'];

                        var rate_quality = comment.rate_quality;
                        var rate_delivery = comment.rate_delivery;
                        var rate_reliablity_seller = comment.rate_reliablity_seller;
                        var payment = comment.payment;
                        var efficiency = comment.efficiency;
                        var rate_reliablity_buyer = comment.rate_reliablity_buyer;

                        var avgRate = (rate_quality+rate_delivery+rate_reliablity_buyer+rate_reliablity_seller+payment+efficiency)/6.0;
                        avgRate = Math.round( avgRate * 10) / 10;
                    %>
                    <div style="padding: 19px 22px 22px 100px;" class="comment-content">
                        <div class="arrow-comment"></div>
                        <div class="comment-by">
                            <%
                                var name='';
                                if(comment.feedbackUserId.full_name != null && comment.feedbackUserId.full_name != ''){
                                    name = comment.feedbackUserId.full_name;
                                }else if(comment.feedbackUserId.username != null && comment.feedbackUserId.username != ''){
                                    name = comment.feedbackUserId.username;
                                }
                            %>
                            <strong><%= name %></strong>
                            <span class="date"><%= comment.createdAt.split('T')[0] %></span>
                            <div class="rating <%if(avgRate >= 1) {%><%= rateInString[Math.floor(avgRate)] %>-stars<%}%>">
                                <%if(avgRate >= 1) {%><div class="star-rating"></div><%}%>
                                <div class="star-bg"></div>
                            </div>
                        </div>
                        <p><%= comment.comment%></p>
                    </div>
                </li>
                <% } %>
            </ul>

        </div>
    </div>
    <br><br>
    <% if(item.similarItems.length > 0) {%>
        <!-- Related Products -->
        <div class="container margin-top-5">

            <!-- Headline -->
            <div class="sixteen columns">
                <h3 class="headline">Related Products</h3>
                <span class="line margin-bottom-0"></span>
            </div>

            <!-- Products -->
            <div class="products">

                <% for(var itemIndex = 0; itemIndex < item.similarItems.length; itemIndex++) {
                    var similarItem = item.similarItems[itemIndex];
                    if(similarItem.id != item.item.id) {
                %>
                    <div class="four columns">
                        <figure class="product">
                            <div class="mediaholder">
                                <a href="/items/id/<%= similarItem.id %>">
                                <% if(similarItem.ItemImages.length > 0) {%>
                                    <img alt="" src="uploads/items/<%= similarItem.ItemImages[0].url %>" style="width: 280px; height: 280px"/>
                                <% } else { %>
                                    <img alt="" src="images/shop_item_01.jpg" style="width: 280px; height: 280px"/>
                                <% } %>
                                <% if(similarItem.ItemImages.length > 1) {%>
                                    <div class="cover">
                                        <img alt="" src="uploads/items/<%= similarItem.ItemImages[1].url %>" style="width: 270px; height: 270px"/>
                                    </div>
                                <% } %>
                                <a href="/items/id/<%= similarItem.id %>" class="product-button"><i class="fa fa-shopping-cart"></i> Make Offer</a>
                            </div>

                            <a href="/items/id/<%= similarItem.id %>">
                                <section>
                                    <span class="product-category"><%= similarItem.title %></span>
                                    <%
                                        var name='';
                                        if(similarItem.User.company_name != null && similarItem.User.company_name != ''){
                                            name = similarItem.User.company_name;
                                        } else if(similarItem.User.full_name != null && similarItem.User.full_name != ''){
                                            name = similarItem.User.full_name;
                                        }else if(similarItem.User.username != null && similarItem.User.username != ''){
                                            name = similarItem.User.username;
                                        }
                                    %>
                                    <h5><%= name %></h5>
                                </section>
                            </a>
                        </figure>
                    </div>
                <%  }
                }
                %>

            </div>
        </div>

    <% } %>

    <div class="margin-top-50"></div>

    <!-- Footer
    ================================================== -->
    <% include footer.ejs %>

</div>


<!-- Java Script
================================================== -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="scripts/jquery.jpanelmenu.js"></script>
<script src="scripts/jquery.themepunch.plugins.min.js"></script>
<script src="scripts/jquery.themepunch.revolution.min.js"></script>
<script src="scripts/jquery.themepunch.showbizpro.min.js"></script>
<script src="scripts/jquery.magnific-popup.min.js"></script>
<script src="scripts/hoverIntent.js"></script>
<script src="scripts/superfish.js"></script>
<script src="scripts/jquery.pureparallax.js"></script>
<script src="scripts/jquery.pricefilter.js"></script>
<script src="scripts/jquery.selectric.min.js"></script>
<script src="scripts/jquery.royalslider.min.js"></script>
<script src="scripts/SelectBox.js"></script>
<script src="scripts/modernizr.custom.js"></script>
<script src="scripts/waypoints.min.js"></script>
<script src="scripts/jquery.flexslider-min.js"></script>
<script src="scripts/jquery.counterup.min.js"></script>
<script src="scripts/jquery.tooltips.min.js"></script>
<script src="scripts/jquery.isotope.min.js"></script>
<script src="scripts/puregrid.js"></script>
<script src="scripts/stacktable.js"></script>
<script src="scripts/custom.js"></script>
<script src="scripts/views/bid.js"></script>
<script src="scripts/views/header_func.js"></script>

</body>
</html>